# 선착순 포인트 지급 시스템

## 프로젝트 실행 방법

### 설치 및 실행 명령어

#### 1. Redis 실행
```bash
# Docker로 Redis 실행
docker run -d -p 6379:6379 --name redis redis:latest

# 또는 로컬 Redis 실행
redis-server
```

#### 2. 애플리케이션 실행
```bash
# 권한 부여 (Unix/Linux/macOS)
chmod +x gradlew

# 애플리케이션 실행
./gradlew bootRun
```

## API 명세

### 포인트 신청 엔드포인트

**URL**: `POST /api/v1/point/apply`

**Request Body**:
```json
{
  "userId": 12345
}
```

**응답 포맷 및 예시**:

**성공 응답**:
```json
{
  "success": true,
  "message": "포인트 신청이 완료되었습니다.",
  "data": {
    "order": 1,
    "amount": 100000,
    "userId": 12345,
    "createdBy": "2024-07-08T10:30:00"
  }
}
```

**실패 응답 - 중복 신청**:
```json
{
  "success": false,
  "message": "이미 신청한 사용자입니다.",
  "data": null
}
```

**실패 응답 - 마감**:
```json
{
  "success": false,
  "message": "신청 마감되었습니다.",
  "data": null
}
```

### 포인트 지급 규칙
- 1~100번: 100,000점
- 101~2,000번: 50,000점  
- 2,001~5,000번: 20,000점
- 5,001~10,000번: 10,000점
- 10,001명 이후: 지급 없음

## 처리 로직 설명

### 선착순 판별 방식
- Redis INCR 연산을 활용한 원자적 순서 보장
- Lua 스크립트로 중복 검사와 순서 할당을 동시 처리

### 동시성/중복 방지 처리 방식
- Redis Lua 스크립트로 원자적 연산 보장
- Set 자료구조를 이용한 사용자별 중복 신청 방지
- 트랜잭션을 통한 데이터베이스 일관성 보장

## 테스트

### 1. 기본 테스트 실행
```bash
./gradlew test
```

### 2. 10,000명 동시 접속 부하 테스트

#### JUnit 기반 테스트
```bash
# 성능 및 동시성 테스트 실행
./gradlew performanceTest

# 또는 개별 테스트 클래스 실행
./gradlew test --tests "ConcurrencyTest"
./gradlew test --tests "PerformanceTest"
```

#### Shell 스크립트 기반 테스트
```bash
# 1. 애플리케이션 실행
./gradlew bootRun

# 2. 별도 터미널에서 부하 테스트 실행
chmod +x load-test.sh
./load-test.sh
```

#### 독립 실행 부하 테스트
```bash
# 1. 애플리케이션 실행
./gradlew bootRun

# 2. 별도 터미널에서 Kotlin 부하 테스트 실행
./gradlew run --args="LoadTest"
```

### 3. 테스트 시나리오

#### 동시성 테스트
- **목적**: 10,000명이 동시에 포인트 신청
- **검증**: 중복 처리 방지, 순서 보장, 최대 참가자 수 제한
- **예상 결과**: 정확히 10,000명만 성공, 나머지는 마감 처리

#### 성능 테스트  
- **목적**: 응답 시간, 처리량, 안정성 측정
- **메트릭**: 
  - 평균 응답시간 < 1초
  - 95% 응답시간 < 2초  
  - 처리량 > 100 req/s
  - 성공률 > 99%

#### 단계별 부하 테스트
- **목적**: 점진적 부하 증가로 시스템 한계 측정
- **단계**: 100 → 500 → 1,000 → 2,000 → 5,000 → 10,000명

### 4. 테스트 결과 예시
```
🚀 성능 테스트 결과
============================================================
📊 기본 통계:
  총 요청 수: 10000
  성공 수: 10000
  실패 수: 0
  성공률: 100.00%

⏱️  시간 통계:
  총 처리 시간: 15423ms
  처리량: 648.74 req/s

📈 응답시간 통계 (ms):
  평균: 245ms
  최소: 45ms
  최대: 1205ms
  50th percentile (median): 198ms
  95th percentile: 567ms
  99th percentile: 823ms
  표준편차: 124.56ms

✅ 성능 기준 검증:
  평균 응답시간 < 1초: ✅ PASS (245ms)
  95% 응답시간 < 2초: ✅ PASS (567ms)
  처리량 > 100 req/s: ✅ PASS (648.74 req/s)
  성공률 > 99%: ✅ PASS (100.00%)

🎯 전체 결과: ✅ PASS
============================================================
```
