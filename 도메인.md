# 선착순 포인트 지급 시스템

## 도메인 개요
선착순으로 포인트를 지급하는 시스템입니다. 사용자가 포인트 신청을 하면 순서에 따라 차등 포인트를 지급합니다.

## 핵심 도메인 모델

### 1. PointEvent (포인트 이벤트)
```kotlin
data class PointEvent(
    val id: Long? = null,
    val title: String,
    val startTime: LocalDateTime,
    val endTime: LocalDateTime,
    val totalParticipants: Int,
    val currentParticipants: Int = 0,
    val status: EventStatus = EventStatus.PENDING
)
```

### 2. PointApplication (포인트 신청)
```kotlin
data class PointApplication(
    val id: Long? = null,
    val eventId: Long,
    val userId: String,
    val applicationOrder: Int,
    val appliedAt: LocalDateTime = LocalDateTime.now(),
    val pointAmount: Int,
    val status: ApplicationStatus = ApplicationStatus.PENDING
)
```

### 3. EventStatus (이벤트 상태)
```kotlin
enum class EventStatus {
    PENDING,    // 대기중
    ACTIVE,     // 진행중
    COMPLETED,  // 완료
    CANCELLED   // 취소
}
```

### 4. ApplicationStatus (신청 상태)
```kotlin
enum class ApplicationStatus {
    PENDING,    // 대기중
    APPROVED,   // 승인됨
    REJECTED    // 거부됨
}
```

## 포인트 지급 규칙

| 순위 | 지급 포인트 |
|-----|-----------|
| 1~100번 | 100,000점 |
| 101~2,000번 | 50,000점 |
| 2,001~5,000번 | 20,000점 |
| 5,001~10,000번 | 10,000점 |
| 10,001명 이후 | 지급 없음 |

## 핵심 비즈니스 로직

### 1. 포인트 계산 로직
```kotlin
fun calculatePoints(order: Int): Int {
    return when (order) {
        in 1..100 -> 100_000
        in 101..2_000 -> 50_000
        in 2_001..5_000 -> 20_000
        in 5_001..10_000 -> 10_000
        else -> 0
    }
}
```

### 2. 선착순 판별 방식
- Redis의 INCR 연산을 활용한 원자적 순서 보장
- 동시성 제어를 위한 분산 락 메커니즘
- 중복 신청 방지를 위한 사용자별 신청 이력 관리

### 3. 동시성 처리 전략
- Redis를 이용한 분산 락 구현
- 사용자별 중복 신청 방지 (Redis Set 활용)
- 순서 보장을 위한 원자적 연산 활용

## 기술적 특징

### 1. 리액티브 프로그래밍
- Spring WebFlux 기반 비동기 처리
- R2DBC를 통한 논블로킹 데이터베이스 접근
- Redis Reactive 를 통한 캐시 처리

### 2. 데이터 저장소
- H2 Database: 포인트 신청 이력 및 이벤트 정보 저장
- Redis: 분산 락, 순서 관리, 중복 방지 캐시

### 3. 성능 최적화
- 메모리 기반 H2 데이터베이스로 빠른 응답
- Redis 클러스터링을 통한 확장성 보장
- 비동기 처리로 높은 동시성 지원

## API 설계

### 엔드포인트
- `POST /api/v1/point/apply` - 포인트 신청
- `GET /api/v1/point/status/{userId}` - 신청 상태 조회
- `GET /api/v1/point/event/{eventId}` - 이벤트 정보 조회

### 응답 형식
```json
{
  "success": true,
  "message": "포인트 신청이 완료되었습니다.",
  "data": {
    "applicationId": 12345,
    "order": 1,
    "pointAmount": 100000,
    "appliedAt": "2024-07-08T10:00:00"
  }
}
```

## 확장 가능성

### 1. 스케일 아웃
- Redis 클러스터를 통한 수평 확장
- 애플리케이션 서버 로드 밸런싱
- 데이터베이스 읽기 전용 복제본 활용

### 2. 모니터링
- 실시간 신청 현황 대시보드
- 성능 메트릭 수집 및 알림
- 오류 추적 및 로깅

### 3. 추가 기능
- 포인트 지급 스케줄링
- 사용자별 포인트 이력 관리
- 이벤트별 통계 및 분석
